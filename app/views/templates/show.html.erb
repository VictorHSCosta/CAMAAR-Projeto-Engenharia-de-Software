<% content_for :title, @template.titulo %>
<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-file-alt"></i> <%= @template.titulo %></h1>
    <div class="btn-group">
      <%= link_to "Editar", edit_template_path(@template), class: "btn btn-warning" %>
      <%= link_to "Voltar", templates_path, class: "btn btn-secondary" %>
    </div>
  </div>
  <div class="row mb-4">
    <div class="col-md-8">
      <div class="mb-3">
        <strong>Descrição:</strong>
        <p class="mb-0"><%= @template.descricao || "Nenhuma descrição fornecida." %></p>
      </div>
    </div>
    <div class="col-md-4">
      <div class="mb-3">
        <span class="badge <%= @template.publico_alvo == 'alunos' ? 'badge-aluno' : 'badge-professor' %>">
          <i class="fas fa-<%= @template.publico_alvo == 'alunos' ? 'graduation-cap' : 'chalkboard-teacher' %>"></i>
          <%= @template.publico_alvo.humanize %>
        </span>
      </div>
      <div class="mb-3">
        <strong>Disciplina:</strong> <%= @template.disciplina.nome %>
      </div>
      <div class="mb-3">
        <strong>Criado por:</strong> <%= @template.criado_por.name %>
      </div>
      <div class="mb-3">
        <strong>Data:</strong> <%= @template.created_at.strftime("%d/%m/%Y") %>
      </div>
    </div>
  </div>
  <div class="table-container">
    <h5>Perguntas do Template (<%= @template.pergunta.count %>)</h5>
    <div class="table-responsive">
      <table class="table">
        <thead>
          <tr>
            <th>#</th>
            <th>Pergunta</th>
            <th>Tipo</th>
            <th>Obrigatória</th>
            <th>Opções</th>
          </tr>
        </thead>
        <tbody>
          <% @template.pergunta.each_with_index do |pergunta, index| %>
            <tr>
              <td><%= index + 1 %></td>
              <td><%= pergunta.texto %></td>
              <td>
                <% case pergunta.tipo %>
                <% when 'verdadeiro_falso' %>
                  <span class="badge badge-info">Verdadeiro/Falso</span>
                <% when 'multipla_escolha' %>
                  <span class="badge badge-warning">Múltipla Escolha</span>
                <% when 'subjetiva' %>
                  <span class="badge badge-success">Subjetiva</span>
                <% end %>
              </td>
              <td>
                <% if pergunta.obrigatoria %>
                  <span class="badge badge-danger">Sim</span>
                <% else %>
                  <span class="badge badge-secondary">Não</span>
                <% end %>
              </td>
              <td>
                <% if pergunta.tipo == 'multipla_escolha' && pergunta.opcoes_pergunta.any? %>
                  <ul class="mb-0 small">
                    <% pergunta.opcoes_pergunta.each do |opcao| %>
                      <li><%= opcao.texto %></li>
                    <% end %>
                  </ul>
                <% else %>
                  <span class="text-muted">-</span>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
    <% if @template.pergunta.empty? %>
      <div class="text-center py-4">
        <i class="fas fa-question-circle fa-3x text-muted mb-3"></i>
        <h5 class="text-muted">Nenhuma pergunta cadastrada</h5>
        <p class="text-muted">Este template ainda não possui perguntas.</p>
        <%= link_to "Editar Template", edit_template_path(@template), class: "btn btn-primary" %>
      </div>
    <% end %>
  </div>
</div>
M.E.: <%= tipo_counts['multipla_escolha'] %>
</span>
<% end %>
<% if tipo_counts['subjetiva'].to_i > 0 %>
  <span class="badge bg-secondary me-1">
    <i class="fas fa-pen me-1"></i>
    Subj.: <%= tipo_counts['subjetiva'] %>
  </span>
<% end %>
</div>
</div>
</div>
</div>
<!-- Ações -->
<div class="card">
  <div class="card-header">
    <h5 class="card-title mb-0">
      <i class="fas fa-cog me-2"></i>
      Ações
    </h5>
  </div>
  <div class="card-body">
    <div class="d-grid gap-2">
      <%= link_to edit_template_path(@template), class: "btn btn-warning" do %>
        <i class="fas fa-edit me-2"></i>
        Editar Template
      <% end %>
      <%= link_to @template, method: :delete, 
                            confirm: "Tem certeza que deseja remover este template?", 
                            class: "btn btn-danger",
                            data: { turbo_method: :delete } do %>
        <i class="fas fa-trash me-2"></i>
        Remover Template
      <% end %>
    </div>
  </div>
</div>
</div>
<!-- Perguntas do Template -->
<div class="col-md-8">
  <div class="card">
    <div class="card-header">
      <h5 class="card-title mb-0">
        <i class="fas fa-question-circle me-2"></i>
        Perguntas do Template (<%= @template.pergunta.count %>)
      </h5>
    </div>
    <div class="card-body">
      <% if @template.pergunta.any? %>
        <% @template.pergunta.order(:id).each_with_index do |pergunta, index| %>
          <div class="pergunta-preview border rounded p-3 mb-3 <%= 'bg-light' if index.even? %>">
            <div class="d-flex justify-content-between align-items-start mb-2">
              <h6 class="mb-0">
                <span class="badge bg-primary me-2"><%= index + 1 %></span>
                <%= pergunta.texto %>
              </h6>
              <div class="d-flex align-items-center gap-2">
                <span class="badge bg-<%= pergunta.tipo == 'verdadeiro_falso' ? 'info' : pergunta.tipo == 'multipla_escolha' ? 'warning' : 'secondary' %>">
                  <i class="fas fa-<%= pergunta.tipo == 'verdadeiro_falso' ? 'check' : pergunta.tipo == 'multipla_escolha' ? 'list' : 'pen' %> me-1"></i>
                  <%= pergunta.tipo.humanize %>
                </span>
                <% if pergunta.obrigatoria? %>
                  <span class="badge bg-danger">
                    <i class="fas fa-asterisk me-1"></i>
                    Obrigatória
                  </span>
                <% end %>
              </div>
            </div>
            <!-- Opções para múltipla escolha -->
            <% if pergunta.multipla_escolha? && pergunta.opcoes_pergunta.any? %>
              <div class="mt-3">
                <label class="form-label fw-bold small">Opções de Resposta:</label>
                <div class="row">
                  <% pergunta.opcoes_pergunta.each_with_index do |opcao, opcao_index| %>
                    <div class="col-md-6 mb-2">
                      <div class="d-flex align-items-center">
                        <span class="badge bg-light text-dark me-2"><%= ('A'.ord + opcao_index).chr %></span>
                        <%= opcao.texto %>
                      </div>
                    </div>
                  <% end %>
                </div>
              </div>
            <% end %>
            <!-- Opções para verdadeiro/falso -->
            <% if pergunta.verdadeiro_falso? %>
              <div class="mt-3">
                <div class="row">
                  <div class="col-md-6">
                    <div class="d-flex align-items-center">
                      <span class="badge bg-success me-2">V</span>
                      Verdadeiro
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="d-flex align-items-center">
                      <span class="badge bg-danger me-2">F</span>
                      Falso
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
            <!-- Tipo subjetiva -->
            <% if pergunta.subjetiva? %>
              <div class="mt-3">
                <div class="form-control bg-light" style="min-height: 60px; border: 2px dashed #dee2e6;">
                  <small class="text-muted">
                    <i class="fas fa-pen me-1"></i>
                    Área para resposta aberta/subjetiva
                  </small>
                </div>
              </div>
            <% end %>
          </div>
        <% end %>
      <% else %>
        <div class="text-center py-5">
          <i class="fas fa-question-circle fa-3x text-muted mb-3"></i>
          <h5 class="text-muted">Nenhuma pergunta encontrada</h5>
          <p class="text-muted">Este template ainda não possui perguntas.</p>
          <%= link_to edit_template_path(@template), class: "btn btn-primary" do %>
            <i class="fas fa-edit me-2"></i>
            Adicionar Perguntas
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>
</div>
</div>
</div>
</div>
<style>
  .user-avatar-small {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: var(--primary-purple);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 14px;
  }

  .pergunta-preview {
    transition: all 0.3s ease;
  }

  .pergunta-preview:hover {
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }

  .card {
    border: 1px solid #e3e6f0;
    border-radius: 0.75rem;
    box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
  }

  .badge {
    font-size: 0.75rem;
  }
</style>
